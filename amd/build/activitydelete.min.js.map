{"version":3,"file":"activitydelete.min.js","sources":["../src/activitydelete.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Show a delete Nolej h5p activity modal\n *\n * @module      local_nolej\n * @author      Vincenzo Padula <vincenzo@oc-group.eu>\n * @copyright   2025 OC Open Consulting SB Srl\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(\n    ['jquery', 'core/modal_factory', 'core/str', 'core/modal_events', 'core/templates'],\n    function($, ModalFactory, String, ModalEvents, Templates) {\n        // Initialize single activity delete confirmation modal.\n        var trigger = $('[data-action=\"delete\"]');\n        ModalFactory.create({\n            type: ModalFactory.types.SAVE_CANCEL,\n            title: String.get_string('deletecontent', 'core_contentbank'),\n            preShowCallback: function(triggerElement, modal) {\n                triggerElement = $(triggerElement);\n                let urlparams = new URLSearchParams(window.location.search);\n                let documentid = urlparams.get('documentid');\n                modal.params = {\n                    'activityid': triggerElement[0].getAttribute('data-activityid'),\n                    'documentid': documentid,\n                };\n                let activityname = triggerElement[0].getAttribute('data-activityname');\n                const body = String.get_string(\n                    'deletecontentconfirm',\n                    'core_contentbank',\n                    {\n                        name: activityname,\n                    }\n                );\n                modal.setBody(body);\n                modal.setSaveButtonText(String.get_string('delete'));\n            }\n        }, trigger)\n            .done(function(modal) {\n                modal.getRoot().on(ModalEvents.save, function(e) {\n                    e.preventDefault();\n                    var deleteurl = new URL(M.cfg.wwwroot + '/local/nolej/activitiesdelete.php');\n                    deleteurl.searchParams.append('activityid', modal.params.activityid);\n                    deleteurl.searchParams.append('documentid', modal.params.documentid);\n                    deleteurl.searchParams.append('contextid', M.cfg.contextid);\n                    deleteurl.searchParams.append('sesskey', M.cfg.sesskey);\n                    window.location.href = deleteurl.toString();\n                });\n            });\n\n        // Initialize bulk activity delete confirmation modal.\n        $('form[name=\"activitiesmanagement\"] #formactionid').on('change', function() {\n            const form = $('form[name=\"activitiesmanagement\"]')[0];\n\n            const checked = $('form[name=\"activitiesmanagement\"] input.activitycheckbox:checked');\n            if (checked.length <= 0) {\n                // No activities selected.\n                return;\n            }\n\n            switch ($(this).val()) {\n                case '#delete':\n                    ModalFactory.create({\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        title: String.get_string('deletecontents', 'local_nolej'),\n                    })\n                        .then(function(modal) {\n                            const activities = checked.closest('tr').find('a:first').map(function() {\n                                return {\n                                    name: $(this).text(),\n                                };\n                            }).get();\n                            const body = Templates.render(\n                                'local_nolej/activitiesdelete',\n                                {\n                                    activities,\n                                }\n                            );\n                            modal.setBody(body);\n                            modal.setSaveButtonText(String.get_string('delete'));\n\n                            modal.getRoot().on(ModalEvents.save, function(e) {\n                                e.preventDefault();\n                                const deleteurl = new URL(M.cfg.wwwroot + '/local/nolej/activitiesdelete.php');\n                                form.action = deleteurl;\n                                form.submit();\n                            });\n\n                            modal.show();\n                            return;\n                        });\n            }\n        });\n    }\n);\n"],"names":["define","$","ModalFactory","String","ModalEvents","Templates","trigger","create","type","types","SAVE_CANCEL","title","get_string","preShowCallback","triggerElement","modal","documentid","URLSearchParams","window","location","search","get","params","getAttribute","activityname","body","name","setBody","setSaveButtonText","done","getRoot","on","save","e","preventDefault","deleteurl","URL","M","cfg","wwwroot","searchParams","append","activityid","contextid","sesskey","href","toString","form","checked","length","this","val","then","activities","closest","find","map","text","render","action","submit","show"],"mappings":";;;;;;;;AAuBAA,oCACI,CAAC,SAAU,qBAAsB,WAAY,oBAAqB,mBAClE,SAASC,EAAGC,aAAcC,OAAQC,YAAaC,eAEvCC,QAAUL,EAAE,0BAChBC,aAAaK,OAAO,CAChBC,KAAMN,aAAaO,MAAMC,YACzBC,MAAOR,OAAOS,WAAW,gBAAiB,oBAC1CC,gBAAiB,SAASC,eAAgBC,OACtCD,eAAiBb,EAAEa,oBAEfE,WADY,IAAIC,gBAAgBC,OAAOC,SAASC,QACzBC,IAAI,cAC/BN,MAAMO,OAAS,YACGR,eAAe,GAAGS,aAAa,8BAC/BP,gBAEdQ,aAAeV,eAAe,GAAGS,aAAa,2BAC5CE,KAAOtB,OAAOS,WAChB,uBACA,mBACA,CACIc,KAAMF,eAGdT,MAAMY,QAAQF,MACdV,MAAMa,kBAAkBzB,OAAOS,WAAW,aAE/CN,SACEuB,MAAK,SAASd,OACXA,MAAMe,UAAUC,GAAG3B,YAAY4B,MAAM,SAASC,GAC1CA,EAAEC,qBACEC,UAAY,IAAIC,IAAIC,EAAEC,IAAIC,QAAU,qCACxCJ,UAAUK,aAAaC,OAAO,aAAc1B,MAAMO,OAAOoB,YACzDP,UAAUK,aAAaC,OAAO,aAAc1B,MAAMO,OAAON,YACzDmB,UAAUK,aAAaC,OAAO,YAAaJ,EAAEC,IAAIK,WACjDR,UAAUK,aAAaC,OAAO,UAAWJ,EAAEC,IAAIM,SAC/C1B,OAAOC,SAAS0B,KAAOV,UAAUW,iBAK7C7C,EAAE,mDAAmD8B,GAAG,UAAU,iBACxDgB,KAAO9C,EAAE,qCAAqC,GAE9C+C,QAAU/C,EAAE,yEACd+C,QAAQC,QAAU,IAMb,YADDhD,EAAEiD,MAAMC,MAERjD,aAAaK,OAAO,CAChBC,KAAMN,aAAaO,MAAMC,YACzBC,MAAOR,OAAOS,WAAW,iBAAkB,iBAE1CwC,MAAK,SAASrC,aACLsC,WAAaL,QAAQM,QAAQ,MAAMC,KAAK,WAAWC,KAAI,iBAClD,CACH9B,KAAMzB,EAAEiD,MAAMO,WAEnBpC,MACGI,KAAOpB,UAAUqD,OACnB,+BACA,CACIL,WAAAA,aAGRtC,MAAMY,QAAQF,MACdV,MAAMa,kBAAkBzB,OAAOS,WAAW,WAE1CG,MAAMe,UAAUC,GAAG3B,YAAY4B,MAAM,SAASC,GAC1CA,EAAEC,uBACIC,UAAY,IAAIC,IAAIC,EAAEC,IAAIC,QAAU,qCAC1CQ,KAAKY,OAASxB,UACdY,KAAKa,YAGT7C,MAAM8C"}