{"version":3,"file":"activitydelete.min.js","sources":["../src/activitydelete.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Show a delete Nolej h5p activity modal\n *\n * @module      local_nolej\n * @author      Vincenzo Padula <vincenzo@oc-group.eu>\n * @copyright   2025 OC Open Consulting SB Srl\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/modal_factory', 'core/str', 'core/modal_events', 'core/templates'], function($, ModalFactory, String, ModalEvents, Templates) {\n    // Initialize single activity delete confirmation modal.\n    var trigger = $('[data-action=\"delete\"]');\n    console.log(M);\n    ModalFactory.create({\n        type: ModalFactory.types.SAVE_CANCEL,\n        title: String.get_string('deletecontent', 'core_contentbank'),\n        preShowCallback: function(triggerElement, modal) {\n            triggerElement = $(triggerElement);\n            let urlparams = new URLSearchParams(window.location.search);\n            let documentid = urlparams.get('documentid');\n            modal.params = {\n                'activityid': triggerElement[0].getAttribute('data-activityid'),\n                'documentid': documentid,\n            };\n            let activityname = triggerElement[0].getAttribute('data-activityname');\n            modal.setBody(String.get_string('deletecontentconfirm', 'core_contentbank', { name: activityname }));\n            modal.setSaveButtonText(String.get_string('delete'));\n        }\n    }, trigger)\n        .done(function(modal) {\n            modal.getRoot().on(ModalEvents.save, function(e) {\n                e.preventDefault();\n                var deleteurl = new URL(M.cfg.wwwroot + '/local/nolej/activitiesdelete.php');\n                deleteurl.searchParams.append('activityid', modal.params.activityid);\n                deleteurl.searchParams.append('documentid', modal.params.documentid);\n                deleteurl.searchParams.append('contextid', M.cfg.contextid);\n                deleteurl.searchParams.append('sesskey', M.cfg.sesskey);\n                window.location.href = deleteurl.toString();\n            });\n        });\n\n    // Initialize bulk activity delete confirmation modal.\n    $('form[name=\"activitiesmanagement\"] #formactionid').on('change', function() {\n        const form = $('form[name=\"activitiesmanagement\"]')[0];\n\n        const checked = $('form[name=\"activitiesmanagement\"] input.activitycheckbox:checked');\n        if (checked.length <= 0) {\n            // No activities selected.\n            return;\n        }\n\n        switch ($(this).val()) {\n            case '#delete':\n                ModalFactory.create({\n                    type: ModalFactory.types.SAVE_CANCEL,\n                    title: String.get_string('deletecontents', 'local_nolej'),\n                })\n                    .then(function(modal) {\n                        const activities = checked.closest('tr').find('a:first').map(function() {\n                            return { name: $(this).text() }\n                        }).get();\n                        modal.setBody(Templates.render('local_nolej/activitiesdelete', { activities }));\n                        modal.setSaveButtonText(String.get_string('delete'));\n\n                        modal.getRoot().on(ModalEvents.save, function(e) {\n                            e.preventDefault();\n                            const deleteurl = new URL(M.cfg.wwwroot + '/local/nolej/activitiesdelete.php');\n                            form.action = deleteurl;\n                            form.submit();\n                        });\n\n                        modal.show();\n                    });\n        }\n    });\n});\n"],"names":["define","$","ModalFactory","String","ModalEvents","Templates","trigger","console","log","M","create","type","types","SAVE_CANCEL","title","get_string","preShowCallback","triggerElement","modal","documentid","URLSearchParams","window","location","search","get","params","getAttribute","activityname","setBody","name","setSaveButtonText","done","getRoot","on","save","e","preventDefault","deleteurl","URL","cfg","wwwroot","searchParams","append","activityid","contextid","sesskey","href","toString","form","checked","length","this","val","then","activities","closest","find","map","text","render","action","submit","show"],"mappings":";;;;;;;;AAuBAA,oCAAO,CAAC,SAAU,qBAAsB,WAAY,oBAAqB,mBAAmB,SAASC,EAAGC,aAAcC,OAAQC,YAAaC,eAEnIC,QAAUL,EAAE,0BAChBM,QAAQC,IAAIC,GACZP,aAAaQ,OAAO,CAChBC,KAAMT,aAAaU,MAAMC,YACzBC,MAAOX,OAAOY,WAAW,gBAAiB,oBAC1CC,gBAAiB,SAASC,eAAgBC,OACtCD,eAAiBhB,EAAEgB,oBAEfE,WADY,IAAIC,gBAAgBC,OAAOC,SAASC,QACzBC,IAAI,cAC/BN,MAAMO,OAAS,YACGR,eAAe,GAAGS,aAAa,8BAC/BP,gBAEdQ,aAAeV,eAAe,GAAGS,aAAa,qBAClDR,MAAMU,QAAQzB,OAAOY,WAAW,uBAAwB,mBAAoB,CAAEc,KAAMF,gBACpFT,MAAMY,kBAAkB3B,OAAOY,WAAW,aAE/CT,SACEyB,MAAK,SAASb,OACXA,MAAMc,UAAUC,GAAG7B,YAAY8B,MAAM,SAASC,GAC1CA,EAAEC,qBACEC,UAAY,IAAIC,IAAI7B,EAAE8B,IAAIC,QAAU,qCACxCH,UAAUI,aAAaC,OAAO,aAAcxB,MAAMO,OAAOkB,YACzDN,UAAUI,aAAaC,OAAO,aAAcxB,MAAMO,OAAON,YACzDkB,UAAUI,aAAaC,OAAO,YAAajC,EAAE8B,IAAIK,WACjDP,UAAUI,aAAaC,OAAO,UAAWjC,EAAE8B,IAAIM,SAC/CxB,OAAOC,SAASwB,KAAOT,UAAUU,iBAK7C9C,EAAE,mDAAmDgC,GAAG,UAAU,iBACxDe,KAAO/C,EAAE,qCAAqC,GAE9CgD,QAAUhD,EAAE,yEACdgD,QAAQC,QAAU,IAMb,YADDjD,EAAEkD,MAAMC,MAERlD,aAAaQ,OAAO,CAChBC,KAAMT,aAAaU,MAAMC,YACzBC,MAAOX,OAAOY,WAAW,iBAAkB,iBAE1CsC,MAAK,SAASnC,aACLoC,WAAaL,QAAQM,QAAQ,MAAMC,KAAK,WAAWC,KAAI,iBAClD,CAAE5B,KAAM5B,EAAEkD,MAAMO,WACxBlC,MACHN,MAAMU,QAAQvB,UAAUsD,OAAO,+BAAgC,CAAEL,WAAAA,cACjEpC,MAAMY,kBAAkB3B,OAAOY,WAAW,WAE1CG,MAAMc,UAAUC,GAAG7B,YAAY8B,MAAM,SAASC,GAC1CA,EAAEC,uBACIC,UAAY,IAAIC,IAAI7B,EAAE8B,IAAIC,QAAU,qCAC1CQ,KAAKY,OAASvB,UACdW,KAAKa,YAGT3C,MAAM4C"}